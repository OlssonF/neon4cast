---
output: 
  github_document:
    df_print: tibble
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# neon4cast

<!-- badges: start -->
  [![R-CMD-check](https://github.com/eco4cast/neon4cast/workflows/R-CMD-check/badge.svg)](https://github.com/eco4cast/neon4cast/actions)
<!-- badges: end -->

`neon4cast` provides a collection of convenient helper utilities for anyone entering the EFI NEON Forecasting Challenge.  

## Installation

You can install the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("remotes")
remotes::install_github("eco4cast/neon4cast")
```

## Examples

```{r}
library(neon4cast)
```

For these examples, we will use a forecast generated by the Aquatics Null Model starting
2020-02-01 to show how functions work.  We download this from the EFI server.  In general,
you would replace this `forecast_file` with the forecast file you are developing for the
challenge.

```{r}
example_url <- "https://data.ecoforecast.org/forecasts/aquatics/aquatics-2021-02-01-EFInull.csv.gz"
forecast_file <- "aquatics-2021-02-01-EFInull.csv.gz"
download.file(example_url, forecast_file)
```


### Validate a forecast file

Validating a forecast file runs the same automated checks as the EFI server, verifying that the 
data is in the correct format for the appropriate challenge.  Helpful errors or warnings will 
displayed on any invalid formats.  Note that the validator accepts files in `.csv` (optionally 
compressed as `.csv.gz`) or netcdf.

```{r}
forecast_output_validator("aquatics-2021-02-01-EFInull.csv.gz")
```

### Compute forecast scores locally

Scores for valid forecasts should appear at <https://shiny.ecoforecast.org> the day after they are submitted.  However, it is often more convenient to generate scores locally. Note that the "score" simply the `crps_sample` (for ensemble forecasts) or `crps_norm` (for summary statistic forecasts) score from the
`scoringRules` R package, for each unique prediction (i.e. day/site/variable tuple). 

Note that scores are only possible once the data becomes available in the corresponding targets file! Consider forecasting an earlier period or merely wait for future data to become available. Latencies for individual challenges are listed in each challenge specification.   

```{r}
forecast <- readr::read_csv("aquatics-2021-02-01-EFInull.csv.gz")
score(forecast, theme = "aquatics")
```

### Generate forecast metadata in EML

Coming soon!

### Access EFI snapshots of NOAA forecasts at NEON sites

Many forecasts will want to make use of weather forecasts as potential drivers. EFI downscales NOAA GEFS 35-day forecast products at each NEON site and makes this data available. These helper functions provide convenient access for downloading and stacking the individual forecast files. 

```{r}
download_noaa("ABBY")
abby <- stack_noaa()
abby
```

### Submit a forecast

When you are ready to submit, 

```{r}
submit("aquatics-2021-02-01-EFInull.csv.gz")
```

### Other functions

Encountered a bug?  Facing another challenge in participating in the challenge? Developed a cool approach you would like to share with the community? Open an [issue](https://github.com/eco4cast/neon4cast/issues) or [pull request](https://github.com/eco4cast/neon4cast/pulls) here!


```{r include=FALSE}
unlink("aquatics-2021-02-01-EFInull.csv.gz")
```